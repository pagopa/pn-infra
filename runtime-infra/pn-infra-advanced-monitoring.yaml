AWSTemplateFormatVersion: 2010-09-09
Description: 'This template deploys advanced monitoring alarm'

Parameters:
  ProjectName:
    Type: String
    Description: 'Usually pn can be pnXYZ where XYZ are the feature number, useful to create
      experimental environments without crash official development environment'

  TemplateBucketBaseUrl:
    Type: String
    Description: 'The S3 bucket from which to fetch the templates used by this stack.'

  AlarmSNSTopicArn:
    Type: String
    Description: 'ARN of alarm SNS Topic'

  MetricNamespace:
    Type: String
    Description: 'ARN of alarm SNS Topic'
    Default: 'AdvancedMetric'

  Version:
    Type: String
    Description: 'Version'

  EMDDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  EMDDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  EMDDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  EMDDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  EMDDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  EMDDownstreamAlarmEnableOncall:
    Type: String
    Description: "Create onCall alarm"
    Default: false
    AllowedValues:
      - true
      - false

  OncallEMDDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallEMDDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallEMDDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallEMDDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  ExternalRegistriesCheckoutAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  ExternalRegistriesCheckoutAlarmPeriod:
    Type: Number
    Default: 300

  ExternalRegistriesCheckoutAlarmThreshold:
    Type: Number
    Default: 1

  ExternalRegistriesCheckoutAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  ExternalRegistriesCheckoutAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  ExternalRegistriesCheckoutAlarmEnableOncall:
    Type: String
    Description: "Create onCall alarm"
    Default: false
    AllowedValues:
      - true
      - false

  OncallExternalRegistriesCheckoutAlarmPeriod:
    Type: Number
    Default: 300

  OncallExternalRegistriesCheckoutAlarmThreshold:
    Type: Number
    Default: 1

  OncallExternalRegistriesCheckoutAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallExternalRegistriesCheckoutAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  OneTrustDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  OneTrustDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OneTrustDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OneTrustDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OneTrustDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  OneTrustDownstreamAlarmEnableOncall:
    Type: String
    Description: "Create onCall alarm"
    Default: false
    AllowedValues:
      - true
      - false

  OncallOneTrustDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallOneTrustDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallOneTrustDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallOneTrustDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  IODownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  IODownstreamAlarmPeriod:
    Type: Number
    Default: 300

  IODownstreamAlarmThreshold:
    Type: Number
    Default: 1

  IODownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  IODownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  IODownstreamAlarmEnableOncall:
    Type: String
    Description: "Create onCall alarm"
    Default: false
    AllowedValues:
      - true
      - false

  OncallIODownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallIODownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallIODownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallIODownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  SelfcarePGPnExternalRegistriesDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  SelfcarePGPnExternalRegistriesDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  SelfcarePGPnExternalRegistriesDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  SelfcarePGPnExternalRegistriesDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  SelfcarePGPnExternalRegistriesDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  SelfcarePGPnExternalRegistriesDownstreamAlarmEnableOncall:
    Type: String
    Description: "Create onCall alarm"
    Default: false
    AllowedValues:
      - true
      - false

  OncallSelfcarePGPnExternalRegistriesDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallSelfcarePGPnExternalRegistriesDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallSelfcarePGPnExternalRegistriesDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallSelfcarePGPnExternalRegistriesDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  SelfcarePADownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  SelfcarePADownstreamAlarmPeriod:
    Type: Number
    Default: 300

  SelfcarePADownstreamAlarmThreshold:
    Type: Number
    Default: 1

  SelfcarePADownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  SelfcarePADownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  SelfcarePADownstreamAlarmEnableOncall:
    Type: String
    Description: "Create onCall alarm"
    Default: false
    AllowedValues:
      - true
      - false

  OncallSelfcarePADownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallSelfcarePADownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallSelfcarePADownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallSelfcarePADownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  AdEDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  AdEDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  AdEDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  AdEDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  AdEDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  AdEDownstreamAlarmEnableOncall:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false

  OncallAdEDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallAdEDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallAdEDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallAdEDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1


  IPADownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  IPADownstreamAlarmPeriod:
    Type: Number
    Default: 300

  IPADownstreamAlarmThreshold:
    Type: Number
    Default: 1

  IPADownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  IPADownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  IPADownstreamAlarmEnableOncall:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false

  OncallIPADownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallIPADownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallIPADownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallIPADownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  ANPRDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  ANPRDownstreamAlarmPeriodExcludeFilterPattern:
    Type: String
    Default: ""

  ANPRDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  ANPRDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  ANPRDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  ANPRDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  ANPRDownstreamAlarmEnableOncall:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false

  OncallANPRDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallANPRDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallANPRDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallANPRDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1


  INADDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  INADDownstreamAlarmPeriodExcludeFilterPattern:
    Type: String
    Default: ""

  INADDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  INADDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  INADDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  INADDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  INADDownstreamAlarmEnableOncall:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false

  OncallINADDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallINADDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallINADDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallINADDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1


  PDNDDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  PDNDDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  PDNDDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  PDNDDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  PDNDDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  PDNDDownstreamAlarmEnableOncall:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false

  OncallPDNDDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallPDNDDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallPDNDDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallPDNDDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1


  InfoCamereDownstreamAlarmPeriodFilterPattern:
    Type: String
    Default: '{ $.level = "ERROR" }'

  InfoCamereDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  InfoCamereDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  InfoCamereDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  InfoCamereDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

  InfoCamereDownstreamAlarmEnableOncall:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false

  OncallInfoCamereDownstreamAlarmPeriod:
    Type: Number
    Default: 300

  OncallInfoCamereDownstreamAlarmThreshold:
    Type: Number
    Default: 1

  OncallInfoCamereDownstreamAlarmEvaluationPeriods:
    Type: Number
    Default: 12

  OncallInfoCamereDownstreamAlarmPeriodDatapointsToAlarm:
    Type: Number
    Default: 1

Mappings:
  DownstreamAlarms:
    EMD:
      LogGroup: /aws/ecs/pn-emd-integration
      Metric: emd-downstream-detection
    ExternalRegistriesCheckout:
      LogGroup: /aws/ecs/pn-external-registries-checkout
      Metric: external-registries-checkout-payment-error-detection
    OneTrust:
      LogGroup: /aws/ecs/pn-external-registries
      Metric: pn-external-registries-OneTrust-downstream-detection
    IO:
      LogGroup: /aws/ecs/pn-external-registries
      Metric: pn-external-registries-IO-downstream-detection
    SelfcarePGPnExternalRegistries:
      LogGroup: /aws/ecs/pn-external-registries
      Metric: pn-external-registries-SelfcarePG-downstream-detection
    SelfcarePA:
      LogGroup: /aws/ecs/pn-external-registries
      Metric: pn-external-registries-SelfcarePA-downstream-detection
    AdE:
      LogGroup: /aws/ecs/pn-national-registries
      Metric: pn-national-registries-AdE-downstream-detection
    IPA:
      LogGroup: /aws/ecs/pn-national-registries
      Metric: pn-national-registries-IPA-downstream-detection
    ANPR:
      LogGroup: /aws/ecs/pn-national-registries
      Metric: pn-national-registries-ANPR-downstream-detection
    INAD:
      LogGroup: /aws/ecs/pn-national-registries
      Metric: pn-national-registries-INAD-downstream-detection
    PDND:
      LogGroup: /aws/ecs/pn-national-registries
      Metric: pn-national-registries-PDND-downstream-detection
    InfoCamere:
      LogGroup: /aws/ecs/pn-national-registries
      Metric: pn-national-registries-InfoCamere-downstream-detection

Resources:

  EMDDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, EMD, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, EMD, LogGroup]
        FilterPattern: !Ref EMDDownstreamAlarmPeriodFilterPattern
        Period: !Ref EMDDownstreamAlarmPeriod
        Threshold: !Ref EMDDownstreamAlarmThreshold
        EvaluationPeriods: !Ref EMDDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref EMDDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref EMDDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallEMDDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallEMDDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallEMDDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallEMDDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  ExternalRegistriesCheckoutAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, ExternalRegistriesCheckout, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, ExternalRegistriesCheckout, LogGroup]
        FilterPattern: !Ref ExternalRegistriesCheckoutAlarmPeriodFilterPattern
        Period: !Ref ExternalRegistriesCheckoutAlarmPeriod
        Threshold: !Ref ExternalRegistriesCheckoutAlarmThreshold
        EvaluationPeriods: !Ref ExternalRegistriesCheckoutAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref ExternalRegistriesCheckoutAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref ExternalRegistriesCheckoutAlarmEnableOncall
        OncallPeriod: !Ref OncallExternalRegistriesCheckoutAlarmPeriod
        OncallThreshold: !Ref OncallExternalRegistriesCheckoutAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallExternalRegistriesCheckoutAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallExternalRegistriesCheckoutAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  OneTrustDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, OneTrust, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, OneTrust, LogGroup]
        FilterPattern: !Ref OneTrustDownstreamAlarmPeriodFilterPattern
        Period: !Ref OneTrustDownstreamAlarmPeriod
        Threshold: !Ref OneTrustDownstreamAlarmThreshold
        EvaluationPeriods: !Ref OneTrustDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref OneTrustDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref OneTrustDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallOneTrustDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallOneTrustDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallOneTrustDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallOneTrustDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  IODownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, IO, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, IO, LogGroup]
        FilterPattern: !Ref IODownstreamAlarmPeriodFilterPattern
        Period: !Ref IODownstreamAlarmPeriod
        Threshold: !Ref IODownstreamAlarmThreshold
        EvaluationPeriods: !Ref IODownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref IODownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref IODownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallIODownstreamAlarmPeriod
        OncallThreshold: !Ref OncallIODownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallIODownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallIODownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  SelfcarePGPnExternalRegistriesDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, SelfcarePGPnExternalRegistries, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, SelfcarePGPnExternalRegistries, LogGroup]
        FilterPattern: !Ref SelfcarePGPnExternalRegistriesDownstreamAlarmPeriodFilterPattern
        Period: !Ref SelfcarePGPnExternalRegistriesDownstreamAlarmPeriod
        Threshold: !Ref SelfcarePGPnExternalRegistriesDownstreamAlarmThreshold
        EvaluationPeriods: !Ref SelfcarePGPnExternalRegistriesDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref SelfcarePGPnExternalRegistriesDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref SelfcarePGPnExternalRegistriesDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallSelfcarePGPnExternalRegistriesDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallSelfcarePGPnExternalRegistriesDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallSelfcarePGPnExternalRegistriesDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallSelfcarePGPnExternalRegistriesDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  SelfcarePADownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, SelfcarePA, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, SelfcarePA, LogGroup]
        FilterPattern: !Ref SelfcarePADownstreamAlarmPeriodFilterPattern
        Period: !Ref SelfcarePADownstreamAlarmPeriod
        Threshold: !Ref SelfcarePADownstreamAlarmThreshold
        EvaluationPeriods: !Ref SelfcarePADownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref SelfcarePADownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref SelfcarePADownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallSelfcarePADownstreamAlarmPeriod
        OncallThreshold: !Ref OncallSelfcarePADownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallSelfcarePADownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallSelfcarePADownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  AdEDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, AdE, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, AdE, LogGroup]
        FilterPattern: !Ref AdEDownstreamAlarmPeriodFilterPattern
        Period: !Ref AdEDownstreamAlarmPeriod
        Threshold: !Ref AdEDownstreamAlarmThreshold
        EvaluationPeriods: !Ref AdEDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref AdEDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref AdEDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallAdEDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallAdEDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallAdEDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallAdEDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  IPADownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, IPA, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, IPA, LogGroup]
        FilterPattern: !Ref IPADownstreamAlarmPeriodFilterPattern
        Period: !Ref IPADownstreamAlarmPeriod
        Threshold: !Ref IPADownstreamAlarmThreshold
        EvaluationPeriods: !Ref IPADownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref IPADownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref IPADownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallIPADownstreamAlarmPeriod
        OncallThreshold: !Ref OncallIPADownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallIPADownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallIPADownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  ANPRDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, ANPR, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, ANPR, LogGroup]
        FilterPattern: !Ref ANPRDownstreamAlarmPeriodFilterPattern
        ExcludeFilterPattern: !Ref ANPRDownstreamAlarmPeriodExcludeFilterPattern
        Period: !Ref ANPRDownstreamAlarmPeriod
        Threshold: !Ref ANPRDownstreamAlarmThreshold
        EvaluationPeriods: !Ref ANPRDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref ANPRDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref ANPRDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallANPRDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallANPRDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallANPRDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallANPRDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  INADDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, INAD, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, INAD, LogGroup]
        FilterPattern: !Ref INADDownstreamAlarmPeriodFilterPattern
        ExcludeFilterPattern: !Ref INADDownstreamAlarmPeriodExcludeFilterPattern
        Period: !Ref INADDownstreamAlarmPeriod
        Threshold: !Ref INADDownstreamAlarmThreshold
        EvaluationPeriods: !Ref INADDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref INADDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref INADDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallINADDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallINADDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallINADDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallINADDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  PDNDDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, PDND, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, PDND, LogGroup]
        FilterPattern: !Ref PDNDDownstreamAlarmPeriodFilterPattern
        Period: !Ref PDNDDownstreamAlarmPeriod
        Threshold: !Ref PDNDDownstreamAlarmThreshold
        EvaluationPeriods: !Ref PDNDDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref PDNDDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref PDNDDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallPDNDDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallPDNDDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallPDNDDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallPDNDDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

  InfoCamereDownstreamDetectionAlarm:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/custom-metric.yaml"
      Parameters:
        AlarmSNSTopicArn: !Ref AlarmSNSTopicArn
        MetricName: !FindInMap [DownstreamAlarms, InfoCamere, Metric]
        MetricNamespace: !Ref MetricNamespace
        LogGroupName: !FindInMap [DownstreamAlarms, InfoCamere, LogGroup]
        FilterPattern: !Ref InfoCamereDownstreamAlarmPeriodFilterPattern
        Period: !Ref InfoCamereDownstreamAlarmPeriod
        Threshold: !Ref InfoCamereDownstreamAlarmThreshold
        EvaluationPeriods: !Ref InfoCamereDownstreamAlarmEvaluationPeriods
        DatapointsToAlarm: !Ref InfoCamereDownstreamAlarmPeriodDatapointsToAlarm
        Statistic: Sum
        ComparisonOperator: GreaterThanOrEqualToThreshold
        HasOncall: !Ref InfoCamereDownstreamAlarmEnableOncall
        OncallPeriod: !Ref OncallInfoCamereDownstreamAlarmPeriod
        OncallThreshold: !Ref OncallInfoCamereDownstreamAlarmThreshold
        OncallEvaluationPeriods: !Ref OncallInfoCamereDownstreamAlarmEvaluationPeriods
        OncallDatapointsToAlarm: !Ref OncallInfoCamereDownstreamAlarmPeriodDatapointsToAlarm
        OncallComparisonOperator: GreaterThanOrEqualToThreshold
        OncallStatistic: Sum

Outputs:
  Version:
    Value: !Ref Version
    Description: 'keep track of used projects commitIds'