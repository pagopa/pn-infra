AWSTemplateFormatVersion: 2010-09-09
Description: 'This template deploys the queues needed for comuication between microservices and 
              API gateway custom domains'

Parameters:
  ProjectName:
    Type: String
    Description: 'Usually pn can be pnXYZ where XYZ are the feature number, useful to create
      experimental environments without crash official development environment'

  EnvironmentType:
    Type: String
    Default: ''
    Description: Environment type

  TemplateBucketBaseUrl:
    Type: String
    Description: 'The S3 bucket from which to fetch the templates used by this stack.'

  ApiDnsName:
    Type: String
    Description: 'The DNS name used for B2B rest API.'

  SandboxSafeStorageBaseUrl:
    Type: String
    Default: "-"
    Description: 'safeStorage Url'

  AlternateApiDnsName:
    Type: String
    Default: ''
    Description: 'The alternate DNS name used for B2B rest API.'

  ApiCertificateArn:
    Type: String
    Description: 'The certificate used for B2B rest API.'

  SelcpgApiDnsName:
    Type: String
    Default: ''
    Description: 'The DNS name used for B2B Selfcare PG API.'

  AlternateSelcpgApiDnsName:
    Type: String
    Default: ''
    Description: 'The alternate DNS name used for B2B Selfcare PG API.'

  SelcpgApiCertificateArn:
    Type: String
    Default: ''
    Description: 'The certificate used for B2B Selfcare PG API.'

  WebApiDnsName:
    Type: String
    Description: 'The DNS name used for browser rest API.'

  BoApiDnsName:
    Type: String
    Default: ''
    Description: 'The DNS name used for BO API'

  CNApiDnsName:
    Type: String
    Default: ''
    Description: 'The DNS name user for CN API'

  AlternateWebApiDnsName:
    Type: String
    Default: ''
    Description: 'The alternate DNS name used for browser rest API. '

  WebApiCertificateArn:
    Type: String
    Description: 'The certificate used for browser rest API.'

  IoApiDnsName:
    Type: String
    Description: 'The DNS name used for IO API rest'

  AlternateIoApiDnsName:
    Type: String
    Default: ''
    Description: 'The alternate DNS name used for IO API rest.'

  IoApiCertificateArn:
    Type: String
    Description: 'The certificate used for browser rest IO API.'

  HostedZoneId:
    Description: "Hosted Zone Id in which you want to add record"
    Type: String
  
  Version:
    Type: String
    Description: 'keep track of used projects commitIds'

  CustomDomainsRequired:
    Type: String
    Default: true
    AllowedValues:
      - true
      - false

  LogRetention:
    Type: Number
    Default: 14
    Description: Default log retention in days

  # pass-though parameters
  LambdasBucketName:
    Type: String
  LambdasBasePath:
    Type: String
  NetworkLoadBalancerLink:
    Type: String
  ApplicationLoadBalancerListenerArn:
    Type: String
  ApplicationLoadBalancerDomain:
    Type: String
  AlarmSNSTopicArn:
    Type: String
  AlarmSNSTopicName:
    Type: String
  VpcId:
    Type: String
  SubnetsIds:
    Type: String
  ECSClusterName:
    Type: String
  CorsAllowedDomains:
    Type: String
  EcsDefaultSecurityGroup:
    Type: String
  LogsBucketName:
    Type: String
#  LogsBucketKmsKeyArn:
#    Type: String
  LogsExporterRoleArn:
    Type: String
  LogsExporterPolicyArn:
    Type: String
  AlbSecurityGroup:
    Type: String
  CognitoUserPoolArn:
    Type: String
    Default: ''
  CognitoClientId:
    Type: String
    Default: ''
  ConfidentialInfoAccountId:
    Default: ''
    Type: String
  OpenSearchArn:
    Default: ''
    Type: String
  OpenSearchEndpoint:
    Type: String
    Default: ''
  HelpdeskAccountId:
    Default: ''
    Type: String
  CdcKinesisStreamName:
    Type: String
  CdcKinesisStreamArn:
    Type: String
  CdcKinesisStreamKeyArn:
    Type: String
  LogsKinesisStreamName:
    Type: String
  LogsKinesisStreamArn:
    Type: String
  LogsKinesisStreamKeyArn:
    Type: String
  SafeStorageAccountId:
    Type: String
  ApiKeyTablesEncryptKeyId:
    Type: String

  VpcEgressSubnetsIds:
    Type: String

  ElasticacheEndpoint:
    Type: String
    Default: ''
  ElasticacheSecurityGroup:
    Type: String
    Default: ''

  CdnZoneId:
    Type: String
    Default: '-'  
  PortalePaCertificateArn:
    Type: String
    Default: '-'
  PortalePfCertificateArn:
    Type: String
    Default: '-'    
  PortalePfLoginCertificateArn:
    Type: String
    Default: '-'    
  LandingCertificateArn:
    Type: String
    Default: '-' 
  PortalePgCertificateArn:
    Type: String
    Default: '-' 
  PortaleStatusCertificateArn:
    Type: String
    Default: '-' 
  PortaleHelpdeskCertificateArn:
    Type: String
    Default: '-'
  PortalePaDomain:
    Type: String
    Default: '-' 
  PortalePfDomain:
    Type: String
    Default: '-' 
  PortalePfLoginDomain:
    Type: String
    Default: '-' 
  LandingDomain:
    Type: String
    Default: '-' 
  PortalePgDomain:
    Type: String
    Default: '-' 
  PortaleStatusDomain:
    Type: String
    Default: '-' 
  PortaleHelpdeskDomain:
    Type: String
    Default: '-'
  HubLoginDomain: 
    Type: String
    Default: '-'
  ReactAppUrlApi:
    Type: String
    Default: '-' 
  TokenExchangeLambdaEnvironmentIssuer:
    Type: String
    Description: Session token issuer
  TokenExchangeLambdaEnvironmentAllowedIssuer:
    Type: String
    Description: 'Comma separated list of external authentication token issuers 
                  recognized by Piattaforma Notifiche (SelfCare and SpidHub)'
  TokenExchangeLambdaEnvironmentAllowedOrigin:
    Type: String
    Description: 'Comma separated list of websites allowed to use "Piattaforma 
                 Notifiche" back-ends API'
  TokenExchangeLambdaEnvironmentJwksMapping:
    Type: String
    Description: 'Mapping tra issuer e jwks url non standard in formato json'
  TokenExchangeLambdaEnvironmentAcceptedAudience:
    Type: String
    Description: Comma separated list of token audience accepted
  TokenExchangeLambdaEnvironmentAudience:
    Type: String
    Description: Audience value for token generation
  ApikeyAuthorizerV2PDNDAudience:
    Type: String
    Description: Pdnd Audience for ApikeyAuthorizerV2

  SafestorageLoggerLogGroupName:
    Type: String

  ExternalChannelBaseUrl:
    Type: String

  BackupCronExpression:
    Type: String

  ApplicationLoadBalancerMetricsDimensionName:
    Type: String
    Default: ''

  IOBackendCidrs:
    Type: CommaDelimitedList
    Description: comma separated list of IO Backend CIDRs
    Default: ''

  CNBackendCidrs:
    Type: CommaDelimitedList
    Description: comma separated list of Conservazione Sostitutiva backend CIDRs
    Default: ''

Conditions:
  RequiresCustomDomains: !Equals [ !Ref CustomDomainsRequired, true ]

  HasSelcpgApiDns: !Not [ !Equals [ !Ref SelcpgApiDnsName, '' ] ]
  HasSelcpgApiCertificate: !Not [ !Equals [ !Ref SelcpgApiCertificateArn, '' ] ]  
  HasSelcpgApi: !And [ !Condition HasSelcpgApiDns, !Condition HasSelcpgApiCertificate, !Condition RequiresCustomDomains ]

  HasAlternateApiDnsName: !Not 
    - !Equals
      - !Ref AlternateApiDnsName
      - ""
  HasAlternateWebApiDnsName: !Not 
    - !Equals
      - !Ref AlternateWebApiDnsName
      - ""

  HasAlternateSelcpgApiDnsName: !Not 
    - !Equals
      - !Ref AlternateSelcpgApiDnsName
      - ""

  HasAlternateIoApiDnsName: !Not 
    - !Equals
      - !Ref AlternateIoApiDnsName
      - ""

Resources:

  ###            COMMON RESOURCES FOR WEB API AND DISTRIBUTIONS            ###
  ############################################################################

  # Custom domain for B2B api
  ApiCustomDomain:
    Type: AWS::CloudFormation::Stack
    Condition: RequiresCustomDomains
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/api-gw-custom-domain.yaml"
      Parameters:
        DnsName: !Ref ApiDnsName
        AlternateDnsName: !Ref AlternateApiDnsName
        CertificateArn: !Ref ApiCertificateArn
        HostedZoneId: !Ref HostedZoneId

  # Custom domain for B2B api selcpg
  SelcpgApiCustomDomain:
    Type: AWS::CloudFormation::Stack
    Condition: HasSelcpgApi
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/api-gw-custom-domain.yaml"
      Parameters:
        DnsName: !Ref SelcpgApiDnsName
        AlternateDnsName: !Ref AlternateSelcpgApiDnsName
        CertificateArn: !Ref SelcpgApiCertificateArn
        HostedZoneId: !Ref HostedZoneId

  # Custom domain for B2B api
  WebApiCustomDomain:
    Type: AWS::CloudFormation::Stack
    Condition: RequiresCustomDomains
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/api-gw-custom-domain.yaml"
      Parameters:
        DnsName: !Ref WebApiDnsName
        AlternateDnsName: !Ref AlternateWebApiDnsName
        CertificateArn: !Ref WebApiCertificateArn
        HostedZoneId: !Ref HostedZoneId

  # Custom domain for IO api
  IoApiCustomDomain:
    Type: AWS::CloudFormation::Stack
    Condition: RequiresCustomDomains
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/api-gw-custom-domain.yaml"
      Parameters:
        DnsName: !Ref IoApiDnsName
        AlternateDnsName: !Ref AlternateIoApiDnsName
        CertificateArn: !Ref IoApiCertificateArn
        HostedZoneId: !Ref HostedZoneId

  ###                    QUEUES BETWEEN MICRO SERVICES                    ###
  ###########################################################################

  ### Communication FROM SafeStorage TO pn-delivery-push ###
  SafeStorageToDeliveryPushQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain  
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-safestore_to_deliverypush'
        DelaySeconds: 1
        VisibilityTimeout: 60
        MaxReceiveCount: 10
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Communication FROM SafeStorage TO pn-radd ###
  SafeStorageToRaddQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain  
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-safestore_to_radd'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Communication FROM SafeStorage TO pn-service-desk ###
  SafeStorageToServiceDeskQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain  
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-safestore_to_servicedesk'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Communication between PN-DELIVERY and PN-DELIVERY-PUSH ###
  DeliveryPushInputsQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain  
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-delivery_push_inputs'
        DelaySeconds: 10        
        AlarmSNSTopicName: !Ref AlarmSNSTopicName
        FifoQueue: true

  ### Communication FROM EXTERNAL-CHANNELS ###
  ExternalChannelsOutputsQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain  
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-external_channel_outputs'
        DelaySeconds: 1
        VisibilityTimeout: 60
        MaxReceiveCount: 10
        AlarmSNSTopicName: !Ref AlarmSNSTopicName
  
  ExternalChannels2UserAttributesQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-external_channel_to_user_attributes'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ExternalChannels2PaperChannelQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-external_channel_to_paper_channel'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Communication FROM KAFKA-BRIDGE
  KafkaBridgeOnboardingQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-kafka_bridge_onboarding'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Queue that receive composite alarm information for DOWNTIME LOGS ###
  CompositeAlarmQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-composite_alarms_for_downtime'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName
  
  ### Queue that receive safe-storage notification to DOWNTIME LOGS ###
  SafeStorageToDowntimeLogsQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-safestore_to_downtime_logs'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName     
  
  ### Communications FROM the Gateway Service of NATIONAL-REGISTRY ###
  NationalRegistryGatewayOutputsQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-national_registry_gateway_outputs'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Communication FROM pn-national-registries TO pn-delivery-push ###
  NationalRegistries2DeliveryPushQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-nationalregistries_to_deliverypush'
        DelaySeconds: 1
        VisibilityTimeout: 60
        MaxReceiveCount: 10        
        AlarmSNSTopicName: !Ref AlarmSNSTopicName
  
  ### Communication FROM pn-national-registries TO pn-paper-channel ###
  NationalRegistries2PaperChannelQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-nationalregistries_to_paperchannel'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName
  
  ### Communication FROM pn-national-registries TO Self Care PG ###
  ### Queue to be exposed to Selfcare PG (Azure) see issue PN-3837 ###
  NationalRegistries2SelcPGQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-nationalregistries_to_selcpg'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName
  
  ### Communication FROM pn-mandate TO pn-delivery ###
  Mandate2DeliveryQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-mandate_to_delivery'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Communication FROM pn-address-manager TO pn-delivery-push ###
  AddressManagerToDeliveryPushQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-addressmanager_to_deliverypush'
        DelaySeconds: 1
        VisibilityTimeout: 60
        MaxReceiveCount: 10        
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

  ### Queue that receive safe-storage notification to DOWNTIME LOGS ###
  AcmAlarmsQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-acm_alarms-DLQ'
        DelaySeconds: 1
        AlarmSNSTopicName: !Ref AlarmSNSTopicName   
        HasDLQ:  "false"
        OncallDLQLimit: '1'
        QueueHasAlarm:  "true"

  ### Communication FROM pn-paper-channel TO pn-service-desk ###
  PaperChannelToServiceDeskQueue:
    Type: AWS::CloudFormation::Stack
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain      
    Properties:
      TemplateURL: !Sub "${TemplateBucketBaseUrl}/fragments/sqs-queue.yaml"
      Parameters:
        QueueName: !Sub '${ProjectName}-paperchannel_to_servicedesk'
        DelaySeconds: 1
        VisibilityTimeout: 60
        MaxReceiveCount: 10        
        AlarmSNSTopicName: !Ref AlarmSNSTopicName

Outputs:
  # Web API for browsers and B2B
  ApiDnsName:
    Value: !If [ HasAlternateApiDnsName, !Ref AlternateApiDnsName, !Ref ApiDnsName ]
    Description: 'The DNS name used for B2B rest API.'
  WebApiDnsName:
    Value: !If [ HasAlternateWebApiDnsName, !Ref AlternateWebApiDnsName, !Ref WebApiDnsName ]
    Description: 'The DNS name used for browser rest API.'
  IoApiDnsName:
    Value: !If [ HasAlternateIoApiDnsName, !Ref AlternateIoApiDnsName, !Ref IoApiDnsName ]
    Description: 'The DNS name used for browser rest API.'
  SelcpgApiDnsName:
    Value: !If [ HasAlternateSelcpgApiDnsName, !Ref AlternateSelcpgApiDnsName, !Ref SelcpgApiDnsName ]
    Description: 'The DNS name used for B2B Selfecare PG rest API.'
  CNApiDnsName:
    Value: !Ref CNApiDnsName
    
  # SafeStorage to DeliveryPush
  SafeStorageToDeliveryPushQueueName:
    Value: !GetAtt SafeStorageToDeliveryPushQueue.Outputs.QueueName
    Description: SafeStorage-to-delivery-push queue name
  SafeStorageToDeliveryPushQueueURL:
    Value: !GetAtt SafeStorageToDeliveryPushQueue.Outputs.QueueURL
    Description: SafeStorage-to-delivery-push queue URL
  SafeStorageToDeliveryPushQueueARN:
    Value: !GetAtt SafeStorageToDeliveryPushQueue.Outputs.QueueARN
    Description: SafeStorage-to-delivery-push queue ARN
  SafeStorageToDeliveryPushQueueAlarmARN:
    Value: !GetAtt SafeStorageToDeliveryPushQueue.Outputs.SqsDLQAlarmArn
    Description: SafeStorage-to-delivery-push queue alarm ARN
  SafeStorageToDeliveryPushQueueAgeAlarmARN:
    Value: !GetAtt SafeStorageToDeliveryPushQueue.Outputs.SqsAgeAlarmArn
    Description: SafeStorage-to-delivery-push queue age alarm ARN

  # SafeStorage to Radd
  SafeStorageToRaddQueueName:
    Value: !GetAtt SafeStorageToRaddQueue.Outputs.QueueName
    Description: SafeStorage-to-radd queue name
  SafeStorageToRaddQueueURL:
    Value: !GetAtt SafeStorageToRaddQueue.Outputs.QueueURL
    Description: SafeStorage-to-radd queue URL
  SafeStorageToRaddQueueARN:
    Value: !GetAtt SafeStorageToRaddQueue.Outputs.QueueARN
    Description: SafeStorage-to-radd queue ARN
  SafeStorageToRaddQueueAlarmARN:
    Value: !GetAtt SafeStorageToRaddQueue.Outputs.SqsDLQAlarmArn
    Description: SafeStorage-to-radd queue alarm ARN
  SafeStorageToRaddQueueAgeAlarmARN:
    Value: !GetAtt SafeStorageToRaddQueue.Outputs.SqsAgeAlarmArn
    Description: SafeStorage-to-radd queue age alarm ARN

  # SafeStorage to ServiceDesk
  SafeStorageToServiceDeskQueueName:
    Value: !GetAtt SafeStorageToServiceDeskQueue.Outputs.QueueName
    Description: SafeStorage-to-servicedesk queue name
  SafeStorageToServiceDeskQueueURL:
    Value: !GetAtt SafeStorageToServiceDeskQueue.Outputs.QueueURL
    Description: SafeStorage-to-servicedesk queue URL
  SafeStorageToServiceDeskQueueARN:
    Value: !GetAtt SafeStorageToServiceDeskQueue.Outputs.QueueARN
    Description: SafeStorage-to-servicedesk queue ARN
  SafeStorageToServiceDeskQueueAlarmARN:
    Value: !GetAtt SafeStorageToServiceDeskQueue.Outputs.SqsDLQAlarmArn
    Description: SafeStorage-to-servicedesk queue alarm ARN
  SafeStorageToServiceDeskQueueAgeAlarmARN:
    Value: !GetAtt SafeStorageToServiceDeskQueue.Outputs.SqsAgeAlarmArn
    Description: SafeStorage-to-servicedesk queue age alarm ARN

  # Delivery push inputs
  DeliveryPushInputsQueueName:
    Value: !GetAtt DeliveryPushInputsQueue.Outputs.QueueName
    Description: pn-delivery-push input queue name
  DeliveryPushInputsQueueURL:
    Value: !GetAtt DeliveryPushInputsQueue.Outputs.QueueURL
    Description: pn-delivery-push input queue URL
  DeliveryPushInputsQueueARN:
    Value: !GetAtt DeliveryPushInputsQueue.Outputs.QueueARN
    Description: pn-delivery-push input queue ARN
  DeliveryPushInputsQueueAlarmARN:
    Value: !GetAtt DeliveryPushInputsQueue.Outputs.SqsDLQAlarmArn
    Description: pn-delivery-push input queue alarm ARN
  DeliveryPushInputsQueueAgeAlarmARN:
    Value: !GetAtt DeliveryPushInputsQueue.Outputs.SqsAgeAlarmArn
    Description: pn-delivery-push input queue age alarm ARN


  # External channels outputs
  ExternalChannelsOutputsQueueName:
    Value: !GetAtt ExternalChannelsOutputsQueue.Outputs.QueueName
    Description: pn-external-channels output queue name
  ExternalChannelsOutputsQueueURL:
    Value: !GetAtt ExternalChannelsOutputsQueue.Outputs.QueueURL
    Description: pn-external-channels output queue URL
  ExternalChannelsOutputsQueueARN:
    Value: !GetAtt ExternalChannelsOutputsQueue.Outputs.QueueARN
    Description: pn-external-channels output queue ARN
  ExternalChannelsOutputsQueueAlarmARN:
    Value: !GetAtt ExternalChannelsOutputsQueue.Outputs.SqsDLQAlarmArn
    Description: pn-external-channels output queue alarm ARN
  ExternalChannelsOutputsQueueAgeAlarmARN:
    Value: !GetAtt ExternalChannelsOutputsQueue.Outputs.SqsAgeAlarmArn
    Description: pn-external-channels output queue age alarm ARN

  # External channels to user attribute outputs
  ExternalChannels2UserAttributesQueueName:
    Value: !GetAtt ExternalChannels2UserAttributesQueue.Outputs.QueueName
    Description: pn-external-channels output to user-attributes queue name
  ExternalChannels2UserAttributesQueueURL:
    Value: !GetAtt ExternalChannels2UserAttributesQueue.Outputs.QueueURL
    Description: pn-external-channels output to user-attributes queue URL
  ExternalChannels2UserAttributesQueueARN:
    Value: !GetAtt ExternalChannels2UserAttributesQueue.Outputs.QueueARN
    Description: pn-external-channels output to user-attributes queue ARN
  ExternalChannels2UserAttributesQueueAlarmARN:
    Value: !GetAtt ExternalChannels2UserAttributesQueue.Outputs.SqsDLQAlarmArn
    Description: pn-external-channels output to user-attributes queue alarm ARN
  ExternalChannels2UserAttributesQueueAgeAlarmARN:
    Value: !GetAtt ExternalChannels2UserAttributesQueue.Outputs.SqsAgeAlarmArn
    Description: pn-external-channels output to user-attributes queue age alarm ARN

  # External channels to pn-paper-channel
  ExternalChannels2PaperChannelQueueName:
    Value: !GetAtt ExternalChannels2PaperChannelQueue.Outputs.QueueName
    Description: pn-external-channels output to pn-paper-channel queue name
  ExternalChannels2PaperChannelQueueURL:
    Value: !GetAtt ExternalChannels2PaperChannelQueue.Outputs.QueueURL
    Description: pn-external-channels output to pn-paper-channel queue URL
  ExternalChannels2PaperChannelQueueARN:
    Value: !GetAtt ExternalChannels2PaperChannelQueue.Outputs.QueueARN
    Description: pn-external-channels output to pn-paper-channel queue ARN
  ExternalChannels2PaperChannelQueueAlarmARN:
    Value: !GetAtt ExternalChannels2PaperChannelQueue.Outputs.SqsDLQAlarmArn
    Description: pn-external-channels output to pn-paper-channel queue alarm ARN
  ExternalChannels2PaperChannelQueueAgeAlarmARN:
    Value: !GetAtt ExternalChannels2PaperChannelQueue.Outputs.SqsAgeAlarmArn
    Description: pn-external-channels output to pn-paper-channel queue age alarm ARN

  # Kafka bridge onboarding
  KafkaBridgeOnboardingQueueName:
    Value: !GetAtt KafkaBridgeOnboardingQueue.Outputs.QueueName
    Description: pn-kafka-bridge onboarding institutes output queue name
  KafkaBridgeOnboardingQueueURL:
    Value: !GetAtt KafkaBridgeOnboardingQueue.Outputs.QueueURL
    Description: pn-kafka-bridge onboarding institutes output queue URL
  KafkaBridgeOnboardingQueueARN:
    Value: !GetAtt KafkaBridgeOnboardingQueue.Outputs.QueueARN
    Description: pn-kafka-bridge onboarding institutes output queue ARN
  KafkaBridgeOnboardingQueueAlarmARN:
    Value: !GetAtt KafkaBridgeOnboardingQueue.Outputs.SqsDLQAlarmArn
    Description: pn-kafka-bridge onboarding institutes output queue alarm ARN
  KafkaBridgeOnboardingQueueAgeAlarmARN:
    Value: !GetAtt KafkaBridgeOnboardingQueue.Outputs.SqsAgeAlarmArn
    Description: pn-kafka-bridge onboarding institutes output queue age alarm ARN

  # Downtime Logs composite alarm queue
  DowntimeLogsAggregateAlarmQueueName:
    Value: !GetAtt CompositeAlarmQueue.Outputs.QueueName
    Description: Aggregate alarm queue name
  DowntimeLogsAggregateAlarmQueueURL:
    Value: !GetAtt CompositeAlarmQueue.Outputs.QueueURL
    Description: Aggregate alarm queue URL
  DowntimeLogsAggregateAlarmQueueARN:
    Value: !GetAtt CompositeAlarmQueue.Outputs.QueueARN
    Description: Aggregate alarm queue ARN
  DowntimeLogsAggregateAlarmQueueAlarmARN:
    Value: !GetAtt CompositeAlarmQueue.Outputs.SqsDLQAlarmArn
    Description: Aggregate alarm queue alarm ARN
  DowntimeLogsAggregateAlarmQueueAgeAlarmARN:
    Value: !GetAtt CompositeAlarmQueue.Outputs.SqsAgeAlarmArn
    Description: Aggregate alarm queue age alarm ARN
  
  # Downtime Logs safe-storage events
  DowntimeLogsSafeStorageEventsQueueName:
    Value: !GetAtt SafeStorageToDowntimeLogsQueue.Outputs.QueueName
    Description: Events form safe-storage to pn-downtime-logs queue name
  DowntimeLogsSafeStorageEventsQueueURL:
    Value: !GetAtt SafeStorageToDowntimeLogsQueue.Outputs.QueueURL
    Description: Events form safe-storage to pn-downtime-logs queue URL
  DowntimeLogsSafeStorageEventsQueueARN:
    Value: !GetAtt SafeStorageToDowntimeLogsQueue.Outputs.QueueARN
    Description: Events form safe-storage to pn-downtime-logs queue ARN
  DowntimeLogsSafeStorageEventsQueueAlarmARN:
    Value: !GetAtt SafeStorageToDowntimeLogsQueue.Outputs.SqsDLQAlarmArn
    Description: Events form safe-storage to pn-downtime-logs queue alarm ARN
  DowntimeLogsSafeStorageEventsQueueAgeAlarmARN:
    Value: !GetAtt SafeStorageToDowntimeLogsQueue.Outputs.SqsAgeAlarmArn
    Description: Events form safe-storage to pn-downtime-logs queue age alarm ARN

  # Gateway service of NationalRegistry events
  NationalRegistryGatewayOutputsQueueName:
    Value: !GetAtt NationalRegistryGatewayOutputsQueue.Outputs.QueueName
    Description: Events from the gateway service of NationalRegistry queue name
  NationalRegistryGatewayOutputsQueueURL:
    Value: !GetAtt NationalRegistryGatewayOutputsQueue.Outputs.QueueURL
    Description: Events from the gateway service of NationalRegistry queue URL
  NationalRegistryGatewayOutputsQueueARN:
    Value: !GetAtt NationalRegistryGatewayOutputsQueue.Outputs.QueueARN
    Description: Events from the gateway service of NationalRegistry queue ARN
  NationalRegistryGatewayOutputsQueueAlarmARN:
    Value: !GetAtt NationalRegistryGatewayOutputsQueue.Outputs.SqsDLQAlarmArn
    Description: Events from the gateway service of NationalRegistry alarm ARN
  NationalRegistryGatewayOutputsQueueAgeAlarmARN:
    Value: !GetAtt NationalRegistryGatewayOutputsQueue.Outputs.SqsAgeAlarmArn
    Description: Events from the gateway service of NationalRegistry age alarm ARN

  # pn-national-registries TO pn-delivery-push events
  NationalRegistries2DeliveryPushQueueName:
    Value: !GetAtt NationalRegistries2DeliveryPushQueue.Outputs.QueueName
    Description: Events from pn-national-registries TO pn-delivery-push queue name
  NationalRegistries2DeliveryPushQueueURL:
    Value: !GetAtt NationalRegistries2DeliveryPushQueue.Outputs.QueueURL
    Description: Events from pn-national-registries TO pn-delivery-push queue URL
  NationalRegistries2DeliveryPushQueueARN:
    Value: !GetAtt NationalRegistries2DeliveryPushQueue.Outputs.QueueARN
    Description: Events from pn-national-registries TO pn-delivery-push queue ARN
  NationalRegistries2DeliveryPushQueueAlarmARN:
    Value: !GetAtt NationalRegistries2DeliveryPushQueue.Outputs.SqsDLQAlarmArn
    Description: Events from pn-national-registries TO pn-delivery-push alarm ARN
  NationalRegistries2DeliveryPushQueueAgeAlarmARN:
    Value: !GetAtt NationalRegistries2DeliveryPushQueue.Outputs.SqsAgeAlarmArn
    Description: Events from pn-national-registries TO pn-delivery-push age alarm ARN
  
  # pn-national-registries TO pn-paper-channel events
  NationalRegistries2PaperChannelQueueName:
    Value: !GetAtt NationalRegistries2PaperChannelQueue.Outputs.QueueName
    Description: Events from pn-national-registries TO pn-paper-channel queue name
  NationalRegistries2PaperChannelQueueURL:
    Value: !GetAtt NationalRegistries2PaperChannelQueue.Outputs.QueueURL
    Description: Events from pn-national-registries TO pn-paper-channel queue URL
  NationalRegistries2PaperChannelQueueARN:
    Value: !GetAtt NationalRegistries2PaperChannelQueue.Outputs.QueueARN
    Description: Events from pn-national-registries TO pn-paper-channel queue ARN
  NationalRegistries2PaperChannelQueueAlarmARN:
    Value: !GetAtt NationalRegistries2PaperChannelQueue.Outputs.SqsDLQAlarmArn
    Description: Events from pn-national-registries TO pn-paper-channel alarm ARN
  NationalRegistries2PaperChannelQueueAgeAlarmARN:
    Value: !GetAtt NationalRegistries2PaperChannelQueue.Outputs.SqsAgeAlarmArn
    Description: Events from pn-national-registries TO pn-paper-channel age alarm ARN
  
  # pn-national-registries TO Self Care PG events
  NationalRegistries2SelcPGQueueName:
    Value: !GetAtt NationalRegistries2SelcPGQueue.Outputs.QueueName
    Description: Events from pn-national-registries TO Self Care PG queue name
  NationalRegistries2SelcPGQueueURL:
    Value: !GetAtt NationalRegistries2SelcPGQueue.Outputs.QueueURL
    Description: Events from pn-national-registries TO Self Care PG queue URL
  NationalRegistries2SelcPGQueueARN:
    Value: !GetAtt NationalRegistries2SelcPGQueue.Outputs.QueueARN
    Description: Events from pn-national-registries TO Self Care PG queue ARN
  NationalRegistries2SelcPGQueueAlarmARN:
    Value: !GetAtt NationalRegistries2SelcPGQueue.Outputs.SqsDLQAlarmArn
    Description: Events from pn-national-registries TO Self Care PG alarm ARN
  NationalRegistries2SelcPGQueueAgeAlarmARN:
    Value: !GetAtt NationalRegistries2SelcPGQueue.Outputs.SqsAgeAlarmArn
    Description: Events from pn-national-registries TO Self Care PG age alarm ARN

  # Mandate to Delivery events
  Mandate2DeliveryQueueName:
    Value: !GetAtt Mandate2DeliveryQueue.Outputs.QueueName
    Description: Events from Mandate to Delivery queue name
  Mandate2DeliveryQueueURL:
    Value: !GetAtt Mandate2DeliveryQueue.Outputs.QueueURL
    Description: Events from Mandate to Delivery queue URL
  Mandate2DeliveryQueueARN:
    Value: !GetAtt Mandate2DeliveryQueue.Outputs.QueueARN
    Description: Events from Mandate to Delivery queue ARN
  Mandate2DeliveryQueueAlarmARN:
    Value: !GetAtt Mandate2DeliveryQueue.Outputs.SqsDLQAlarmArn
    Description: Events from Mandate to Delivery alarm ARN
  Mandate2DeliveryQueueAgeAlarmARN:
    Value: !GetAtt Mandate2DeliveryQueue.Outputs.SqsAgeAlarmArn
    Description: Events from Mandate to Delivery age alarm ARN

  # Address Manager to Delivery Push events
  AddressManagerToDeliveryPushQueueName:
    Value: !GetAtt AddressManagerToDeliveryPushQueue.Outputs.QueueName
    Description: Events from Address Manager to Delivery Push queue name
  AddressManagerToDeliveryPushQueueURL:
    Value: !GetAtt AddressManagerToDeliveryPushQueue.Outputs.QueueURL
    Description: Events from Address Manager to Delivery Push queue URL
  AddressManagerToDeliveryPushQueueARN:
    Value: !GetAtt AddressManagerToDeliveryPushQueue.Outputs.QueueARN
    Description: Events from Address Manager to Delivery Push queue ARN
  AddressManagerToDeliveryPushQueueAlarmARN:
    Value: !GetAtt AddressManagerToDeliveryPushQueue.Outputs.SqsDLQAlarmArn
    Description: Events from Address Manager to Delivery Push alarm ARN
  AddressManagerToDeliveryPushQueueAgeAlarmARN:
    Value: !GetAtt AddressManagerToDeliveryPushQueue.Outputs.SqsAgeAlarmArn
    Description: Events from Address Manager to Delivery Push age alarm ARN

  # ACM Alarms queue
  AcmAlarmsQueueName:
    Value: !GetAtt AcmAlarmsQueue.Outputs.QueueName
    Description: ACM alarms queue name
  AcmAlarmsQueueURL:
    Value: !GetAtt AcmAlarmsQueue.Outputs.QueueURL
    Description: ACM alarms queue URL
  AcmAlarmsQueueARN:
    Value: !GetAtt AcmAlarmsQueue.Outputs.QueueARN
    Description: ACM alarms queue ARN
  AcmAlarmsQueueAlarmARN:
    Value: !GetAtt AcmAlarmsQueue.Outputs.SqsDLQAlarmArn
    Description: ACM alarms alarm ARN

  # PaperChannel to ServiceDesk events
  PaperChannelToServiceDeskQueueName:
    Value: !GetAtt PaperChannelToServiceDeskQueue.Outputs.QueueName
    Description: paperchannel-to-servicedesk queue name
  PaperChannelToServiceDeskQueueURL:
    Value: !GetAtt PaperChannelToServiceDeskQueue.Outputs.QueueURL
    Description: paperchannel-to-servicedesk queue URL
  PaperChannelToServiceDeskQueueARN:
    Value: !GetAtt PaperChannelToServiceDeskQueue.Outputs.QueueARN
    Description: paperchannel-to-servicedesk queue ARN
  PaperChannelToServiceDeskQueueAlarmARN:
    Value: !GetAtt PaperChannelToServiceDeskQueue.Outputs.SqsDLQAlarmArn
    Description: paperchannel-to-servicedesk queue alarm ARN
  PaperChannelToServiceDeskQueueAgeAlarmARN:
    Value: !GetAtt PaperChannelToServiceDeskQueue.Outputs.SqsAgeAlarmArn
    Description: paperchannel-to-servicedesk queue age alarm ARN

  # Kinesis Source Stream containing the DynamoDB Change Data Capture events
  CdcKinesisSourceStreamName:
    Description: 'Kinesis source CDC stream name'
    Value: !Ref CdcKinesisStreamName
  CdcKinesisSourceStreamArn:
    Description: 'Kinesis source CDC stream ARN'
    Value: !Ref CdcKinesisStreamArn
  CdcKinesisSourceStreamKeyArn:
    Description: 'Kinesis source CDC stream crypto key ARN'
    Value: !Ref CdcKinesisStreamKeyArn

  # Kinesis Source Stream containing the CloudWatch Logs
  LogsKinesisSourceStreamName:
    Description: 'Kinesis source Logs stream name'
    Value: !Ref LogsKinesisStreamName
  LogsKinesisSourceStreamArn:
    Description: 'Kinesis source Logs stream ARN'
    Value: !Ref LogsKinesisStreamArn
  LogsKinesisSourceStreamKeyArn:
    Description: 'Kinesis source Logs stream crypto key ARN'
    Value: !Ref LogsKinesisStreamKeyArn

  # pass-thought parameters
  NetworkLoadBalancerLink:
    Value: !Ref NetworkLoadBalancerLink
  ApplicationLoadBalancerListenerArn:
    Value: !Ref ApplicationLoadBalancerListenerArn
  ApplicationLoadBalancerDomain:
    Value: !Ref ApplicationLoadBalancerDomain
  AlarmSNSTopicArn:
    Value: !Ref AlarmSNSTopicArn
  AlarmSNSTopicName:
    Value: !Ref AlarmSNSTopicName
  VpcId:
    Value: !Ref VpcId
  SubnetsIds:
    Value: !Ref SubnetsIds
  ECSClusterName:
    Value: !Ref ECSClusterName
  CorsAllowedDomains:
    Value: !Ref CorsAllowedDomains
  EcsDefaultSecurityGroup:
    Value: !Ref EcsDefaultSecurityGroup
  LogsBucketName:
    Value: !Ref LogsBucketName
  #LogsBucketKmsKeyArn:
  #  Value: !Ref LogsBucketKmsKeyArn
  LogsExporterRoleArn:
    Value: !Ref LogsExporterRoleArn
  LogsExporterPolicyArn:
    Value: !Ref LogsExporterPolicyArn
  AlbSecurityGroup:
    Value: !Ref AlbSecurityGroup
  CognitoUserPoolArn:
    Value: !Ref CognitoUserPoolArn
  CognitoClientId:
    Value: !Ref CognitoClientId
  ConfidentialInfoAccountId:
    Value: !Ref ConfidentialInfoAccountId
  HelpdeskAccountId:
    Value: !Ref HelpdeskAccountId
  OpenSearchArn:
    Value: !Ref OpenSearchArn
  OpenSearchEndpoint:
    Value: !Ref OpenSearchEndpoint
  LambdasBucketName:
    Value: !Ref LambdasBucketName
  LambdasBasePath:
    Value: !Ref LambdasBasePath
  EnvironmentType:
    Value: !Ref EnvironmentType
  Version:
    Value: !Ref Version
  SafeStorageAccountId:
    Value: !Ref SafeStorageAccountId
  SandboxSafeStorageBaseUrl:
    Value: !Ref SandboxSafeStorageBaseUrl
  ApiKeyTablesEncryptKeyId:
    Value: !Ref ApiKeyTablesEncryptKeyId
  VpcEgressSubnetsIds:
    Value: !Ref VpcEgressSubnetsIds
  ElasticacheEndpoint:
    Value: !Ref ElasticacheEndpoint
  ElasticacheSecurityGroup:
    Value: !Ref ElasticacheSecurityGroup

  CdnZoneId:
    Value: !Ref CdnZoneId
  PortalePaCertificateArn:
    Value: !Ref PortalePaCertificateArn
  PortalePfCertificateArn:
    Value: !Ref PortalePfCertificateArn
  PortalePfLoginCertificateArn:
    Value: !Ref PortalePfLoginCertificateArn   
  LandingCertificateArn:
    Value: !Ref LandingCertificateArn 
  PortalePgCertificateArn:
    Value: !Ref PortalePgCertificateArn
  PortaleStatusCertificateArn:
    Value: !Ref PortaleStatusCertificateArn 
  PortaleHelpdeskCertificateArn:
    Value: !Ref PortaleHelpdeskCertificateArn
  PortalePaDomain:
    Value: !Ref PortalePaDomain
  PortalePfDomain:
    Value: !Ref PortalePfDomain
  PortalePfLoginDomain:
    Value: !Ref PortalePfLoginDomain    
  LandingDomain:
    Value: !Ref LandingDomain
  PortalePgDomain:
    Value: !Ref PortalePgDomain
  PortaleStatusDomain:
    Value: !Ref PortaleStatusDomain    
  PortaleHelpdeskDomain:
    Value: !Ref PortaleHelpdeskDomain
  ReactAppUrlApi:
    Value: !Ref ReactAppUrlApi
  BoApiDnsName: 
    Value: !Ref BoApiDnsName
  HubLoginDomain:
    Value: !Ref HubLoginDomain
  TokenExchangeLambdaEnvironmentIssuer:
    Value: !Ref TokenExchangeLambdaEnvironmentIssuer
  TokenExchangeLambdaEnvironmentAllowedIssuer:
    Value: !Ref TokenExchangeLambdaEnvironmentAllowedIssuer
  TokenExchangeLambdaEnvironmentAllowedOrigin:
    Value: !Ref TokenExchangeLambdaEnvironmentAllowedOrigin
  TokenExchangeLambdaEnvironmentJwksMapping:
    Value: !Ref TokenExchangeLambdaEnvironmentJwksMapping
  TokenExchangeLambdaEnvironmentAcceptedAudience:
    Value: !Ref TokenExchangeLambdaEnvironmentAcceptedAudience
  TokenExchangeLambdaEnvironmentAudience:
    Value: !Ref TokenExchangeLambdaEnvironmentAudience
  ApikeyAuthorizerV2PDNDAudience:
    Value: !Ref ApikeyAuthorizerV2PDNDAudience
  SafestorageLoggerLogGroupName:
    Value: !Ref SafestorageLoggerLogGroupName
  ExternalChannelBaseUrl:
    Value: !Ref ExternalChannelBaseUrl
  BackupCronExpression:
    Value: !Ref BackupCronExpression
  LogRetention:
    Value: !Ref LogRetention
  ApplicationLoadBalancerMetricsDimensionName:
    Value: !Ref ApplicationLoadBalancerMetricsDimensionName
  IOBackendCidrs:
    Value: !Join [ ",", !Ref IOBackendCidrs ]
  CNBackendCidrs:
    Value: !Join [ ",", !Ref CNBackendCidrs ]